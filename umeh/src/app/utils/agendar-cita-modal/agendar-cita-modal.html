<div class="modal-overlay" (click)="onClose()">
  <div class="modal-content" (click)="$event.stopPropagation()" *ngIf="datosCita">

    <div class="modal-header">
      <h2>Agendar Nueva Cita</h2>
      <button class="modal-close" (click)="onClose()">&times;</button>
    </div>

    <div class="modal-body">
      <div class="cita-info">
        <div *ngIf="datosCita.doctor">
          <p><strong>Médico:</strong> {{ datosCita.doctor.nombre }} {{ datosCita.doctor.apellidos }}</p>
        </div>

        <div *ngIf="!datosCita.doctor" class="form-group">
          <label>Seleccionar Médico:</label>
          <select [(ngModel)]="doctorSeleccionado">
            <option [ngValue]="null">-- Seleccione --</option>
            <option *ngFor="let doc of datosCita.doctoresDisponibles" [ngValue]="doc">
              {{ doc.nombre }} {{ doc.apellidos }}
            </option>
          </select>
        </div>

        <p><strong>Fecha:</strong> {{ datosCita.fecha | date:'dd/MM/yyyy' }}</p>
        <p><strong>Hora:</strong> {{ datosCita.hora.substring(0, 5) }} hrs</p>
      </div>

      <hr>

      <div class="form-group">
        <label>Buscar Paciente:</label>

        <div class="search-container">

          <div class="search-row">
            <div class="input-wrapper">
              <input type="text" placeholder="Nombre(s)" [(ngModel)]="terminoNombre" (keyup)="buscarPaciente()">
            </div>
            <div class="input-wrapper">
              <input type="text" placeholder="Apellidos" [(ngModel)]="terminoApellido" (keyup)="buscarPaciente()">
            </div>
          </div>

          <ul class="search-results" *ngIf="pacientes.length > 0">
            <li *ngFor="let paciente of pacientes" (click)="seleccionarPaciente(paciente)">
              <strong>{{ paciente.nombre }} {{ paciente.apellidos }}</strong>
              <br>
              <small style="color: #666;">Dom: {{ paciente.calle || 'S/N' }}</small>
            </li>
          </ul>

        </div>
      </div>

      <div class="form-group" *ngIf="!datosCita.consultorio">
        <label for="consultorio">Consultorio Disponible:</label>
        <select id="consultorio" name="consultorio" [(ngModel)]="consultorioSeleccionado">
          <option value="" disabled>Seleccione un consultorio</option>
          <option *ngFor="let consultorio of consultoriosDisponibles" [value]="consultorio">
            {{ consultorio }}
          </option>
        </select>
      </div>

      <div class="form-group" *ngIf="datosCita.consultorio">
        <p><strong>Consultorio Asignado:</strong> {{ datosCita.consultorio }}</p>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="onClose()">Cancelar</button>
      <button class="btn btn-primary" (click)="confirmarCita()">Confirmar Cita</button>
    </div>

  </div>
</div>