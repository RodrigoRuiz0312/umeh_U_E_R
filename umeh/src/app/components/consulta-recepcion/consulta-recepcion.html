<!-- gestion-consulta.component.html -->
<div class="gestion-consulta-container">

  <!-- Modal Buscar Nota -->
  <div class="modal-backdrop" *ngIf="mostrarModalNotas">
    <div class="modal-container">

      <h3>Buscar Nota de Remisión</h3>

      <div class="form-group">
        <label>Nombre del paciente *</label>
        <input type="text" [(ngModel)]="filtro.nombre">
      </div>

      <div class="form-group">
        <label>Apellidos (opcional)</label>
        <input type="text" [(ngModel)]="filtro.apellidos">
      </div>

      <div class="form-group">
        <label>Fecha de consulta *</label>
        <input type="date" [(ngModel)]="filtro.fecha">
      </div>

      <button class="btn btn-primary w-100" (click)="buscarNotas()">
        Buscar
      </button>

      <hr>

      <div *ngIf="resultados.length === 0 && intentado">
        <p class="text-muted">No se encontraron consultas en esa fecha.</p>
      </div>

      <table class="table" *ngIf="resultados.length > 0">
        <thead>
          <tr>
            <th>Hora</th>
            <th>Médico</th>
            <th>Total</th>
            <th></th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let r of resultados">
            <td>{{ r.fecha | date:'HH:mm' }}</td>
            <td>{{ r.medico_nombre }} {{ r.medico_apellidos }}</td>
            <td>{{ r.total | currency:'MXN' }}</td>
            <td>
              <button class="btn btn-success btn-sm" (click)="imprimirNota(r.id_consulta)">
                Imprimir
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <button class="btn btn-secondary w-100 mt-3" (click)="cerrarModal()">
        Cerrar
      </button>

    </div>
  </div>

  <!-- Mensajes de error y éxito -->
  <div *ngIf="mensajeError" class="notice notice-danger mb-16">
    {{ mensajeError }}
    <button type="button" class="close" (click)="mensajeError = ''">×</button>
  </div>

  <div *ngIf="mensajeExito" class="notice notice-success mb-16">
    {{ mensajeExito }}
    <button type="button" class="close" (click)="mensajeExito = ''">×</button>
  </div>

  <!-- ============================================ -->
  <!-- PASO 1: BÚSQUEDA DE PACIENTE -->
  <!-- ============================================ -->
  <div *ngIf="paso === 'busqueda'" class="paso-busqueda">
    <div>
      <div class="card-header d-flex align-items-center justify-content-between">
        <h3 class="mb-0">Nueva Consulta - Búsqueda de Paciente</h3>
        <div class="d-flex align-items-center gap-2">
          <button class="btn btn-primary" (click)="abrirModalNotas()">
            Generar Nota Histórica
          </button>
          <button class="btn-reg btn-outline-primary" (click)="irARegistroPaciente()">
            <i class="bi bi-person-plus"></i> Registrar Nuevo Paciente
          </button>
        </div>
      </div>
      <div class="card-body">
        <div class="form-row">
          <div class="form-group">
            <label for="nombre">Nombre del Paciente <span class="requerido">*</span></label>
            <input type="text" id="nombre" [(ngModel)]="nombreBusqueda" (keyup.enter)="buscarPaciente()"
              placeholder="Ingrese el nombre">
          </div>
          <div class="form-group">
            <label for="apellidos">Apellidos (opcional)</label>
            <input type="text" id="apellidos" [(ngModel)]="apellidosBusqueda" (keyup.enter)="buscarPaciente()"
              placeholder="Ingrese los apellidos">
          </div>
          <button class="btn btn-primary" (click)="buscarPaciente()" [disabled]="cargando || !nombreBusqueda.trim()">
            <span *ngIf="cargando" class="spinner-border spinner-border-sm me-2"></span>
            Buscar
          </button>
        </div>

        <!-- Resultados de búsqueda -->
        <div *ngIf="pacientesEncontrados.length > 0" class="mt-16">
          <h5>Pacientes Encontrados:</h5>
          <div class="table-wrapper">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Nombre</th>
                  <th>Apellidos</th>
                  <th>Teléfono(s)</th>
                  <th>Fecha Nacimiento</th>
                  <th>Acción</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let paciente of pacientesEncontrados">
                  <td>{{ paciente.nombre }}</td>
                  <td>{{ paciente.apellidos }}</td>
                  <td>{{ paciente.telefonos || 'N/A' }}</td>
                  <td>{{ paciente.fecha_nacimiento | date: 'dd/MM/yyyy' }}</td>
                  <td>
                    <button class="btn-sel btn-sm btn-success" (click)="seleccionarPaciente(paciente)"
                      [disabled]="isPacienteEnConsultaActiva(paciente)">
                      Seleccionar
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <!--Añadi este apartdo de html vale-->
    <div class="card mb-16">
      <div class="card-header">
        <h3>Citas Agendadas para Hoy</h3>
      </div>
      <div class="card-body">
        <div *ngIf="citasDelDia.length === 0" class="text-center text-muted">
          No hay citas agendadas para hoy.
        </div>
        <div *ngIf="citasDelDia.length > 0" class="table-wrapper">
          <table class="data-table">
            <thead>
              <tr>
                <th>Hora</th>
                <th>Paciente</th>
                <th>Médico</th>
                <th>Estado</th>
                <th>Acción</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let cita of citasDelDia">
                <td>{{ cita.hora.substring(0, 5) }} hrs</td>
                <td>{{ cita.nombre_paciente }} {{ cita.apellidos_paciente }}</td>
                <td>{{ cita.nombre_medico }} {{ cita.apellidos_medico }}</td>
                <td>{{ cita.estado }}</td>
                <td>
                  <button class="btn-sel btn-sm btn-success" (click)="seleccionarCitaParaConsulta(cita)"
                    [disabled]="isCitaDeshabilitada(cita)">
                    <!--{{ cita.estado === 'Agendada' ? 'Iniciar Consulta' : cita.estado }}-->
                    Iniciar Consulta
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Tabla de Consultas Activas -->
    <div class="card mb-16">
      <div class="card-header">
        <h3>Consultas activas</h3>
      </div>
      <div class="card-body">
        <div *ngIf="consultasActivas.length === 0" class="text-center text-muted">
          No hay consultas activas en este momento.
        </div>
        <div *ngIf="consultasActivas.length > 0" class="table-wrapper">
          <table class="data-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Paciente</th>
                <th>Médico</th>
                <th>Estatus</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let c of consultasActivas">
                <td>{{ c.id_consulta }}</td>
                <td>{{ c.paciente_nombre }} {{ c.paciente_apellidos }}</td>
                <td>{{ c.medico_nombre }} {{ c.medico_apellidos }}</td>
                <td>
                  <span class="badge" [ngClass]="{
                    'badge-warning': c.estatus === 'espera',
                    'badge-primary': c.estatus === 'en_atencion',
                    'badge-success': c.estatus === 'completada'
                  }">
                    {{ c.estatus === 'espera' ? 'En Espera' :
                    c.estatus === 'en_atencion' ? 'En Atención' :
                    'Completada' }}
                  </span>
                </td>
                <td>
                  <button *ngIf="c.estatus === 'espera'" class="btn-sel btn-sm btn-primary"
                    (click)="retomarConsultaActiva(c)">
                    <i class="bi bi-play-fill"></i> Atender
                  </button>
                  <button *ngIf="c.estatus === 'en_atencion'" class="btn-sel btn-sm btn-info"
                    (click)="retomarConsultaActiva(c)">
                    <i class="bi bi-arrow-repeat"></i> Continuar
                  </button>
                  <span *ngIf="c.estatus === 'completada'" class="text-success">
                    <i class="bi bi-check-circle-fill"></i> Finalizada
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

  </div>
  <!-- PASO 2: SELECCIÓN DE MÉDICO -->
  <!-- ============================================ -->
  <div *ngIf="paso === 'seleccion-medico'" class="paso-seleccion-medico">
    <div>
      <div class="card-header">
        <h3>Nueva Consulta - Datos de la Consulta</h3>
      </div>
      <div class="card-body">
        <div class="patient-info mb-16">
          <h5>Datos del paciente:</h5>
          <div class="form-row two-cols">
            <div>
              <p><strong>Nombre:</strong> {{ pacienteSeleccionado?.nombre }} {{ pacienteSeleccionado?.apellidos }}</p>
              <p><strong>Teléfono(s):</strong>
                <span *ngIf="pacienteSeleccionado?.telefonos?.length > 0; else noTelefonos">
                  {{ pacienteSeleccionado.telefonos.join(', ') }}
                </span>
                <ng-template #noTelefonos> No registrados</ng-template>
              </p>
              <p><strong>Correo(s):</strong>
                <span *ngIf="pacienteSeleccionado?.correos?.length > 0; else noCorreos">
                  {{ pacienteSeleccionado.correos.join(', ') }}
                </span>
                <ng-template #noCorreos> No registrados</ng-template>
              </p>
            </div>
            <div>
              <p><strong>Sexo:</strong> {{ pacienteSeleccionado?.sexo || 'N/A' }}</p>
              <p><strong>Fecha Nacimiento:</strong> {{ pacienteSeleccionado?.fecha_nacimiento | date: 'dd/MM/yyyy' }}
              </p>
              <p><strong>Domicilio:</strong>
                {{ pacienteSeleccionado?.calle }} #{{ pacienteSeleccionado?.num }},
                Col. {{ pacienteSeleccionado?.colonia }}, {{ pacienteSeleccionado?.estado }}
              </p>
            </div>
          </div>
        </div>

        <!-- Selección de médico -->
        <div class="form-row two-cols">
          <div class="form-group">
            <label for="medico">Médico Asignado *</label>
            <select id="medico" [(ngModel)]="formConsulta.id_medico">
              <option [ngValue]="null">Seleccione un médico</option>
              <option *ngFor="let medico of medicos" [ngValue]="medico.id_medico">
                {{ medico.nombre }} {{ medico.apellidos }} - {{ medico.especialidad }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label for="motivo">Motivo de Consulta</label>
            <input type="text" id="motivo" [(ngModel)]="formConsulta.motivo" placeholder="Opcional">
          </div>
        </div>




        <div class="mt-16 flex justify-between">
          <button class="btn btn-secondary" (click)="paso = 'busqueda'">
            <i class="bi bi-arrow-left"></i> Regresar
          </button>
          <div class="flex gap-16">
            <!--<button class="btn btn-primary" (click)="crearConsulta()" [disabled]="cargando || !medicoSeleccionado">-->
            <button class="btn btn-primary" (click)="crearConsulta()" [disabled]="cargando || !formConsulta.id_medico">
              <span *ngIf="cargando" class="spinner-border spinner-border-sm mr-8"></span>
              Crear Consulta e Imprimir Hoja
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ============================================ -->
  <!-- PASO 4: CAPTURA DE INSUMOS -->
  <!-- ============================================ -->
  <div *ngIf="paso === 'captura-insumos'" class="paso-captura-insumos">
    <div class="card">
      <div class="card-header">
        <h3>Captura de Insumos y Procedimientos</h3>
        <p class="mb-0 text-muted">Consulta No. {{ consultaActual?.id_consulta }}</p>
      </div>
      <div class="card-body">

        <!-- Información del paciente (resumida) -->
        <div class="alert alert-light">
          <strong>Paciente:</strong> {{ pacienteSeleccionado?.nombre }} {{ pacienteSeleccionado?.apellidos }} |
          <strong>Médico:</strong> {{ getMedicoNombre(formConsulta.id_medico) }}

        </div>

        <div class="row-insumos-costos">
          <div class="col-insumos">
            <div class="card mb-4">
              <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Agregar Insumo/Procedimiento</h5>
              </div>
              <div class="card-body">
                <div class="col-md-3">
                  <label for="tipoInsumo" class="form-label">Tipo</label>
                  <select class="form-select" id="tipoInsumo" [(ngModel)]="tipoInsumoBusqueda"
                    (change)="insumosDisponibles = []; busquedaInsumo = ''">
                    <option value="medicamento">Medicamento</option>
                    <option value="material">Material</option>
                    <option value="procedimiento">Procedimiento</option>
                  </select>
                </div>
                <div class="col-md-9">
                  <label for="busquedaInsumo" class="form-label">Buscar {{ tipoInsumoBusqueda }}</label>
                  <input type="text" class="form-control" id="busquedaInsumo" [(ngModel)]="busquedaInsumo"
                    (input)="buscarInsumos()" placeholder="Escriba para buscar..."
                    [disabled]="!!insumoAgregar.id_insumo">
                </div>
              </div>
              <!-- Lista de insumos disponibles -->
              <div *ngIf="insumosDisponibles.length > 0" class="list-group mt-3">
                <button *ngFor="let insumo of insumosDisponibles" type="button"
                  class="list-group-item list-group-item-action" (click)="seleccionarInsumoDisponible(insumo)">
                  <div class="d-flex justify-content-between">
                    <div>
                      <strong>{{ insumo.nombre }}</strong>
                      <br>
                      <small class="text-muted">
                        Disponible: {{ insumo.cantidad }} {{ insumo.unidad }} |
                        Costo: {{ formatearMoneda(insumo.costo_unitario) }}
                      </small>
                    </div>
                  </div>
                </button>
              </div>
            </div>
          </div>

          <div class="col-costos">
            <div class="card mb-4">
              <div class="card-header bg-info text-white">
                <h5 class="mb-0">Costos de Consulta</h5>
              </div>
              <div class="card-body">
                <div class="row g-3 align-items-center mb-3">
                  <div>
                    <label for="costoConsulta" class="form-label fw-bold">Costo de la consulta ($)</label>
                  </div>
                  <div class="col-md-4">
                    <input type="number" id="costoConsulta" class="form-control" [(ngModel)]="costoConsulta" min="0"
                      (change)="guardarCostoConsulta()">
                  </div>
                </div>

                <!-- Costos adicionales -->
                <h6 class="fw-bold mt-3">Procedimientos extra</h6>

                <div class="row g-2 mb-3">
                  <div class="col-md-3">
                    <input type="text" class="form-control" placeholder="Concepto" [(ngModel)]="nuevoExtra.concepto">
                  </div>
                  <div class="col-md-2">
                    <input type="number" class="form-control" placeholder="Costo ($)" [(ngModel)]="nuevoExtra.costo">
                  </div>
                  <div class="col-md-5">
                    <input type="text" class="form-control" placeholder="Observaciones (opcional)"
                      [(ngModel)]="nuevoExtra.observaciones">
                  </div>
                  <div class="col-md-2">
                    <button class="btn btn-primary" (click)="agregarExtra()">
                      <i class="bi bi-plus-circle"></i> Agregar
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Búsqueda de insumos -->
        <div class="card mb-4">
          <!-- Formulario para agregar insumo seleccionado -->
          <div *ngIf="insumoAgregar.id_insumo" class="card-body mt-4">
            <div class="alert alert-success">
              <strong>Seleccionado:</strong> {{ insumoAgregar.nombre }}
            </div>

            <div class="row g-3">
              <div class="col-md-3">
                <label for="cantidad" class="form-label">Cantidad *</label>
                <input type="number" class="form-control" id="cantidad" [(ngModel)]="insumoAgregar.cantidad" min="0.01"
                  step="0.01">
              </div>
              <div class="col-md-3">
                <label class="form-label">Unidad</label>
                <input type="text" class="form-control" [value]="insumoAgregar.unidad" readonly>
              </div>
              <div class="col-md-3">
                <label class="form-label">Costo Unitario</label>
                <input type="text" class="form-control" [value]="formatearMoneda(insumoAgregar.costo_unitario)"
                  readonly>
              </div>
              <div class="col-md-3">
                <label class="form-label">Subtotal</label>
                <input type="text" class="form-control fw-bold"
                  [value]="formatearMoneda(insumoAgregar.cantidad * insumoAgregar.costo_unitario)" readonly>
              </div>
            </div>

            <div class="row g-3 mt-2">
              <div class="col-md-12">
                <label for="descripcion" class="form-label">Descripción/Notas (opcional)</label>
                <input type="text" class="form-control" id="descripcion" [(ngModel)]="insumoAgregar.descripcion"
                  placeholder="Agregar notas adicionales">
              </div>
            </div>

            <div class="mt-3 d-flex gap-2">
              <button class="btn btn-success" (click)="agregarInsumo()"
                [disabled]="cargando || insumoAgregar.cantidad <= 0">
                <span *ngIf="cargando" class="spinner-border spinner-border-sm me-2"></span>
                <i class="bi bi-plus-circle"></i> Agregar a Consulta
              </button>
              <button class="btn btn-secondary"
                (click)="insumoAgregar = { id_insumo: null, nombre: '', tipo: 'medicamento', cantidad: 1, unidad: '', costo_unitario: 0, descripcion: '' }">
                <i class="bi bi-x-circle"></i> Cancelar
              </button>
            </div>
          </div>
        </div>

        <div class="card mb-4">
          <div class="card-header bg-secondary text-white">
            <h5 class="mb-0">Insumos, Procedimientos y Costos Adicionales</h5>
          </div>

          <div class="card-body">
            <div *ngIf="listaCostosCombinada.length === 0" class="text-center text-muted py-4">
              <i class="bi bi-inbox" style="font-size: 3rem;"></i>
              <p class="mt-2">No se han agregado insumos ni costos adicionales</p>
            </div>

            <div *ngIf="listaCostosCombinada.length > 0" class="table-responsive tabla-resumen-container">
              <table class="table table-striped table-hover align-middle">
                <thead class="table-light">
                  <tr>
                    <th>Tipo</th>
                    <th>Nombre / Concepto</th>
                    <th>Cantidad</th>
                    <th>Unidad</th>
                    <th>Costo Unit.</th>
                    <th>Subtotal</th>
                    <th>Observaciones</th>
                    <th>Acción</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of listaCostosCombinada">
                    <td class="celda-tipo" [ngClass]="{
                'bg-primary': item.tipo === 'medicamento',
                'bg-info': item.tipo === 'material',
                'bg-warning': item.tipo === 'procedimiento',
                'bg-danger': item.tipo === 'extra'
              }">
                      {{ item.tipo }}
                    </td>
                    <td>{{ item.nombre }}</td>
                    <td>{{ item.cantidad }}</td>
                    <td>{{ item.unidad }}</td>
                    <td>{{ formatearMoneda(item.costo_unitario) }}</td>
                    <td class="fw-bold">{{ formatearMoneda(item.subtotal) }}</td>
                    <td>{{ item.observaciones || '-' }}</td>
                    <td>
                      <button *ngIf="!item.esExtra && item.id" class="btn btn-sm btn-danger"
                        (click)="eliminarInsumo(+item.id!)">
                        <i class="bi bi-trash-fill"></i>
                      </button>
                      <button *ngIf="item.esExtra && item.id" class="btn btn-sm btn-danger"
                        (click)="eliminarExtra(item.id!)">
                        <i class="bi bi-trash-fill"></i>
                      </button>
                    </td>
                  </tr>
                </tbody>
                <tfoot>
                  <tr>
                    <td colspan="5" class="text-end"><strong>Costo de Consulta:</strong></td>
                    <td colspan="3" class="fw-bold text-end">
                      {{ formatearMoneda(costoConsulta) }}
                    </td>
                  </tr>
                  <tr class="table-active">
                    <td colspan="5" class="text-end"><strong>TOTAL:</strong></td>
                    <td colspan="3" class="fw-bold fs-5 text-success text-end">
                      {{ formatearMoneda(totalConsulta) }}
                    </td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>
        </div>

        <!-- Botones de acción -->
        <div class="d-flex justify-content-between">
          <button class="btn btn-secondary" (click)="paso = 'seleccion-medico'">
            <i class="bi bi-arrow-left"></i> Regresar
          </button>
          <button class="btn btn-success btn-lg" (click)="finalizarConsulta()" [disabled]="cargando">
            <span *ngIf="cargando" class="spinner-border spinner-border-sm me-2"></span>
            <i class="bi bi-check-circle"></i> Finalizar y Generar Nota de Remisión
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ============================================ -->
  <!-- PASO 5: NOTA DE REMISIÓN -->
  <!-- ============================================ -->
  <div *ngIf="paso === 'nota-remision'" class="paso-nota-remision">

    <!-- Botones de acción (no imprimibles) -->
    <div class="no-print mb-3">
      <div class="d-flex justify-content-between align-items-center">
        <!-- Selector de modo -->
        <div class="d-flex align-items-center gap-2">
          <span><strong>Modo de visualización:</strong></span>

          <div *ngIf="!editandoModoNota" class="d-flex align-items-center gap-2">
            <span class="badge" [ngClass]="modoDetallado ? 'bg-info' : 'bg-secondary'">
              {{ modoDetallado ? 'Detallado' : 'Resumido' }}
            </span>
            <button class="btn btn-outline-primary btn-sm" (click)="editandoModoNota = true">
              <i class="bi bi-pencil"></i> Cambiar
            </button>
          </div>

          <div *ngIf="editandoModoNota" class="d-flex align-items-center gap-2">
            <select class="form-select form-select-sm" [(ngModel)]="modoDetallado" style="width: auto;">
              <option [value]="false">Resumido (por categorías)</option>
              <option [value]="true">Detallado (ítem por ítem)</option>
            </select>
            <button class="btn btn-success btn-sm" (click)="cambiarModoNota()">
              <i class="bi bi-check"></i> Guardar
            </button>
            <button class="btn btn-secondary btn-sm" (click)="editandoModoNota = false">
              <i class="bi bi-x"></i> Cancelar
            </button>
          </div>
        </div>

        <div class="d-flex gap-2">
          <button class="btn btn-primary" (click)="generarNotaRemision()" [disabled]="cargando">
            <span *ngIf="cargando" class="spinner-border spinner-border-sm me-2"></span>
            <i class="bi bi-download"></i> Descargar Nota
          </button>
          <button class="btn btn-success" (click)="nuevaConsulta()">
            <i class="bi bi-plus-circle"></i> Nueva Consulta
          </button>
        </div>
      </div>

      <!-- Información sobre los modos -->
      <div class="alert alert-info mt-2 small">
        <strong>Modo Resumido:</strong> Agrupa los insumos por categoría (Medicamento, Material, Procedimiento).<br>
        <strong>Modo Detallado:</strong> Muestra cada insumo individualmente con su nombre específico.
      </div>
    </div>

    <!-- Vista previa de la nota (solo para referencia) -->
    <div class="card no-print mb-4">
      <div class="card-header">
        <h6 class="mb-0">Vista previa de la nota (resumen)</h6>
      </div>
      <div class="card-body">
        <div class="seccion mb-3">
          <h6>PACIENTE</h6>
          <p class="mb-1"><strong>Nombre:</strong> {{ pacienteSeleccionado?.nombre }} {{ pacienteSeleccionado?.apellidos
            }}</p>
          <p class="mb-1"><strong>Teléfono:</strong> {{ pacienteSeleccionado?.telefonos?.join(', ') || 'N/A' }}</p>
        </div>

        <div class="seccion mb-3">
          <h6>DETALLE {{ modoDetallado ? '(DETALLADO)' : '(RESUMIDO)' }}</h6>
          <div *ngIf="listaCostosCombinada.length === 0" class="text-muted">
            No hay insumos registrados
          </div>
          <div *ngIf="listaCostosCombinada.length > 0">
            <div *ngFor="let grupo of getInsumosAgrupados()" class="mb-2">
              <strong>{{ grupo.categoria }}:</strong>
              {{ grupo.total | currency:'MXN':'symbol':'1.2-2' }}
            </div>
            <div><strong>Costo de Consulta:</strong> {{ costoConsulta | currency:'MXN':'symbol':'1.2-2' }}</div>
            <hr>
            <div><strong>TOTAL:</strong> {{ totalConsulta | currency:'MXN':'symbol':'1.2-2' }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>