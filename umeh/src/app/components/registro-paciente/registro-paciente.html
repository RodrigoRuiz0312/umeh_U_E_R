<div class="card">
  <div class="card-header">
    <h2>Registro de paciente</h2>
  </div>

  <p-toast></p-toast>

  <div class="modal-overlay" *ngIf="mostrarModalCamposObligatorios" (click)="cerrarModalCamposObligatorios()">
    <div class="modal-content warning-modal" (click)="$event.stopPropagation()">
      <div class="warning-icon-circle">
        <i class="fa-solid fa-triangle-exclamation"></i>
      </div>

      <h2 class="warning-title">Faltan Datos Obligatorios</h2>

      <p class="warning-message">
        Para continuar con el registro, necesitamos que complete la siguiente información:
      </p>

      <div class="missing-fields-container">
        <div class="missing-field-chip" *ngFor="let campo of camposFaltantes">
          <i class="fa-solid fa-circle-xmark"></i>
          {{ campo }}
        </div>
      </div>

      <button class="btn-understood" (click)="cerrarModalCamposObligatorios()">
        Entendido
      </button>
    </div>
  </div>

  <div class="card-body">
    <form class="paciente-form" [formGroup]="pacienteForm" (ngSubmit)="onSubmit()">

      <h2 class="section-title">Datos personales</h2>

      <div class="form-row">
        <div class="form-group">
          <label for="nombreP">Nombre <span class="requerido">*</span></label>
          <input type="text" id="nombreP" name="nombre" formControlName="nombre" required>
        </div>
        <div class="form-group">
          <label for="apellidosP">Apellidos <span class="requerido">*</span></label>
          <input type="text" id="apellidosP" name="apellidos" formControlName="apellidos" required>
        </div>
      </div>

      <div class="form-group" formArrayName="telefonos">

        <div class="dynamic-label-row">
          <label>Teléfono(s) <span class="requerido">*</span></label>
          <button type="button" class="btn-add" (click)="addTelefono()">
            + Agregar teléfono
          </button>
        </div>

        <div *ngFor="let tel of telefonos.controls; let i = index" class="dynamic-input-row">
          <input type="text" [formControlName]="i" placeholder="Ej. 8112345678" required>
          <button type="button" class="btn-remove" (click)="removeTelefono(i)" *ngIf="telefonos.length > 1">
            &times;
          </button>
        </div>
      </div>

      <div class="form-group" formArrayName="correos">

        <div class="dynamic-label-row">
          <label>Correo(s) electrónico(s)</label>
          <button type="button" class="btn-add" (click)="addCorreo()">
            + Agregar correo
          </button>
        </div>

        <div *ngFor="let correo of correos.controls; let i = index" class="dynamic-input-row">
          <input type="email" [formControlName]="i" placeholder="Ej. paciente@correo.com">
          <button type="button" class="btn-remove" (click)="removeCorreo(i)">
            &times;
          </button>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Sexo: <span class="requerido">*</span></label>
          <div class="radio-group">
            <div class="radio-option">
              <input type="radio" id="sexo-masculino" name="sexo" value="Masculino" formControlName="sexo" required>
              <label for="sexo-masculino">Masculino</label>
            </div>
            <div class="radio-option">
              <input type="radio" id="sexo-femenino" name="sexo" value="Femenino" formControlName="sexo" required>
              <label for="sexo-femenino">Femenino</label>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label for="date_birthdayP">Fecha de nacimiento <span class="requerido">*</span></label>
          <input type="date" id="date_birthdayP" name="fecha_nacimiento" formControlName="fecha_nacimiento" required>
        </div>
      </div>

      <h2 class="section-title">Domicilio</h2>

      <div class="form-group">
        <label for="codigoP">Código postal <span class="requerido">*</span></label>
        <input id="codigo_postal" formControlName="codigo_postal" maxlength="5" placeholder="Ej. 67173"
          (blur)="buscarCP()">
      </div>

      <div *ngIf="cargando" class="loader">Buscando...</div>
      <div *ngIf="errorMsg" class="error">{{ errorMsg }}</div>

      <div class="form-group">
        <label>Estado <span class="requerido">*</span></label>
        <input formControlName="estado" readonly>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Colonia <span class="requerido">*</span></label>
          <select formControlName="colonia">
            <option value="">Seleccione una colonia</option>
            <option *ngFor="let c of colonias" [value]="c">{{ c }}</option>
          </select>
        </div>
        <div class="form-group">
          <label>Municipio <span class="requerido">*</span></label>
          <input formControlName="municipio" readonly>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="calleP">Calle <span class="requerido">*</span></label>
          <input type="text" id="calleP" name="calle" formControlName="calle" required>
        </div>
        <div class="form-group">
          <label for="numP">Número</label>
          <input type="text" id="numP" name="num" formControlName="num">
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="btn-reg btn-outline-primary btn-fix-1" (click)="verRegistros()">Ver
          Registros</button>
        <button type="button" class="btn-reg btn-outline-primary btn-fix-2" (click)="irAConsultaRecepcion()">Realizar
          Consulta</button>
        <button type="submit" class="btn-reg btn-outline-primary">Guardar Datos</button>
      </div>

    </form>
  </div>
</div>